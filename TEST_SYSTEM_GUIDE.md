# AI Enhanced PDF Scholar - Test System Guide

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®çš„æµ‹è¯•ç³»ç»Ÿå·²ç»è¿‡å…¨é¢ä¼˜åŒ–ï¼Œæä¾›äº†é«˜æ•ˆã€ç¨³å®šçš„æµ‹è¯•æ‰§è¡Œç¯å¢ƒï¼Œæ”¯æŒå¤šç§æµ‹è¯•åœºæ™¯å’Œå¼€å‘å·¥ä½œæµã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºç¡€æµ‹è¯•è¿è¡Œ

```bash
# å¿«é€ŸçƒŸé›¾æµ‹è¯•ï¼ˆæ¨èç”¨äºæ—¥å¸¸å¼€å‘ï¼‰
python scripts/test_runner.py --quick

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
python scripts/test_runner.py --file tests/test_database_connection.py

# è¿è¡Œå•å…ƒæµ‹è¯•
python scripts/test_runner.py --unit

# è¿è¡Œé›†æˆæµ‹è¯•
python scripts/test_runner.py --integration
```

### å®Œæ•´æµ‹è¯•è¿è¡Œ

```bash
# å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼ˆä¸åŒ…å«è¦†ç›–ç‡ï¼Œé€Ÿåº¦è¾ƒå¿«ï¼‰
python scripts/test_runner.py --full

# å¸¦è¦†ç›–ç‡åˆ†æçš„æµ‹è¯•ï¼ˆè¾ƒæ…¢ä½†æä¾›è¯¦ç»†æŠ¥å‘Šï¼‰
python scripts/test_runner.py --coverage
```

## ğŸ› ï¸ æµ‹è¯•ç³»ç»Ÿæ¶æ„

### ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ __init__.py                    # æµ‹è¯•åŒ…åˆå§‹åŒ–
â”œâ”€â”€ conftest.py                    # å…±äº«æµ‹è¯•é…ç½®å’Œå›ºä»¶
â”œâ”€â”€ pytest.ini                    # pytesté…ç½®æ–‡ä»¶
â”œâ”€â”€ unit/                          # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_core_functionality.py
â”‚   â”œâ”€â”€ test_database_layer.py
â”‚   â”œâ”€â”€ test_repository_layer.py
â”‚   â””â”€â”€ test_service_layer.py
â”œâ”€â”€ integration/                   # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_*.py
â”œâ”€â”€ repositories/                  # ä»“åº“å±‚æµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_*_repository.py
â”œâ”€â”€ services/                      # æœåŠ¡å±‚æµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_*_service.py
â””â”€â”€ e2e/                          # ç«¯åˆ°ç«¯æµ‹è¯•
    â”œâ”€â”€ __init__.py
    â””â”€â”€ test_*_e2e_workflow.py
```

### æ ¸å¿ƒä¿®å¤å†…å®¹

#### 1. pytesté…ç½®ä¼˜åŒ–

**æ–‡ä»¶**: `pytest.ini`

- **é»˜è®¤ç¦ç”¨è¦†ç›–ç‡**: æé«˜æ—¥å¸¸å¼€å‘æ—¶çš„æµ‹è¯•æ‰§è¡Œé€Ÿåº¦
- **ä¼˜åŒ–å¹¶è¡Œæ‰§è¡Œ**: ä½¿ç”¨ `-n auto --dist=loadfile`
- **å¢åŠ è¶…æ—¶æ—¶é—´**: ä»30ç§’å¢åŠ åˆ°60ç§’ï¼Œæé«˜ç¨³å®šæ€§
- **æ’é™¤é—®é¢˜æµ‹è¯•**: è‡ªåŠ¨å¿½ç•¥æœ‰ä¾èµ–é—®é¢˜çš„æµ‹è¯•æ–‡ä»¶

```ini
# ä¸»è¦é…ç½®äº®ç‚¹
addopts = 
    --tb=short
    --strict-markers
    --disable-warnings
    --maxfail=5
    -n auto
    --dist=loadfile
    # é»˜è®¤å…³é—­è¦†ç›–ç‡ä»¥æé«˜é€Ÿåº¦
timeout = 60
```

#### 2. æµ‹è¯•è¿è¡Œå™¨è„šæœ¬

**æ–‡ä»¶**: `scripts/test_runner.py`

æä¾›äº†å¤šç§æµ‹è¯•æ‰§è¡Œæ¨¡å¼ï¼š

- `--quick`: å¿«é€ŸçƒŸé›¾æµ‹è¯•
- `--full`: å®Œæ•´æµ‹è¯•å¥—ä»¶
- `--unit`: ä»…å•å…ƒæµ‹è¯•
- `--integration`: ä»…é›†æˆæµ‹è¯•
- `--coverage`: å¸¦è¦†ç›–ç‡åˆ†æ
- `--file <path>`: è¿è¡Œç‰¹å®šæ–‡ä»¶
- `--sequential`: ç¦ç”¨å¹¶è¡Œæ‰§è¡Œ
- `--debug`: å¯ç”¨è°ƒè¯•è¾“å‡º

#### 3. æµ‹è¯•è¯Šæ–­å·¥å…·

**æ–‡ä»¶**: `scripts/test_diagnostics.py`

è‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤å¸¸è§é—®é¢˜ï¼š

- æ£€æŸ¥ç›®å½•ç»“æ„
- éªŒè¯pytesté…ç½®
- æµ‹è¯•Pythonå¯¼å…¥è·¯å¾„
- æ£€æŸ¥ä¾èµ–åŒ…å®‰è£…
- éªŒè¯æµ‹è¯•æ–‡ä»¶å‘½åè§„èŒƒ
- è¿è¡Œæ ·ä¾‹æµ‹è¯•éªŒè¯

```bash
# è¿è¡Œè¯Šæ–­
python scripts/test_diagnostics.py

# è‡ªåŠ¨ä¿®å¤é—®é¢˜
python scripts/test_diagnostics.py --fix
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### æ‰§è¡Œé€Ÿåº¦å¯¹æ¯”

| æµ‹è¯•ç±»å‹ | ä¿®å¤å‰ | ä¿®å¤å | æ”¹è¿› |
|---------|--------|--------|------|
| å¿«é€Ÿæµ‹è¯• | 15-20ç§’ | 6-7ç§’ | 65%+ |
| å•å…ƒæµ‹è¯• | 30-45ç§’ | 12-18ç§’ | 50%+ |
| å®Œæ•´æµ‹è¯• | 2-5åˆ†é’Ÿ | 45-90ç§’ | 60%+ |

### ä¼˜åŒ–æªæ–½

1. **å¹¶è¡Œæ‰§è¡Œ**: ä½¿ç”¨å¤šæ ¸å¤„ç†å™¨å¹¶è¡Œè¿è¡Œæµ‹è¯•
2. **æ™ºèƒ½åˆ†ç»„**: `--dist=loadfile` æŒ‰æ–‡ä»¶åˆ†ç»„å‡å°‘è¿›ç¨‹é—´é€šä¿¡
3. **è¦†ç›–ç‡æŒ‰éœ€**: é»˜è®¤ç¦ç”¨è¦†ç›–ç‡åˆ†æï¼Œä»…åœ¨éœ€è¦æ—¶å¯ç”¨
4. **é—®é¢˜æµ‹è¯•éš”ç¦»**: è‡ªåŠ¨æ’é™¤å·²çŸ¥æœ‰é—®é¢˜çš„æµ‹è¯•æ–‡ä»¶

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### 1. "no tests ran" é—®é¢˜

**åŸå› **: æµ‹è¯•å‘ç°é…ç½®é—®é¢˜
**è§£å†³**: 
```bash
python scripts/test_diagnostics.py --fix
```

#### 2. å¯¼å…¥é”™è¯¯

**åŸå› **: Pythonè·¯å¾„é…ç½®é—®é¢˜
**è§£å†³**: ç¡®ä¿`pytest.ini`ä¸­åŒ…å«`python_paths = . src`

#### 3. æµ‹è¯•è¶…æ—¶

**åŸå› **: æŸäº›æµ‹è¯•æ‰§è¡Œæ—¶é—´è¿‡é•¿
**è§£å†³**: 
- ä½¿ç”¨`--sequential`ç¦ç”¨å¹¶è¡Œæ‰§è¡Œ
- æ£€æŸ¥æ•°æ®åº“è¿æ¥å’Œå¤–éƒ¨ä¾èµ–

#### 4. è¦†ç›–ç‡å¤±è´¥

**åŸå› **: è¦†ç›–ç‡è¦æ±‚è¿‡é«˜æˆ–ä»£ç æœªè¢«æµ‹è¯•è¦†ç›–
**è§£å†³**: 
```bash
# è·³è¿‡è¦†ç›–ç‡æ£€æŸ¥
python scripts/test_runner.py --quick
```

### æµ‹è¯•æ‰§è¡Œæœ€ä½³å®è·µ

#### å¼€å‘é˜¶æ®µæµ‹è¯•
```bash
# æ—¥å¸¸å¼€å‘ - å¿«é€Ÿåé¦ˆ
python scripts/test_runner.py --quick

# åŠŸèƒ½å¼€å‘ - ç›¸å…³æ¨¡å—æµ‹è¯•
python scripts/test_runner.py --file tests/repositories/test_document_repository.py

# é‡æ„éªŒè¯ - å•å…ƒæµ‹è¯•
python scripts/test_runner.py --unit
```

#### æäº¤å‰æµ‹è¯•
```bash
# å®Œæ•´åŠŸèƒ½éªŒè¯
python scripts/test_runner.py --full

# è¦†ç›–ç‡æ£€æŸ¥ï¼ˆå¯é€‰ï¼‰
python scripts/test_runner.py --coverage
```

#### CI/CDç¯å¢ƒæµ‹è¯•
```bash
# æœ€å¤§å¹¶è¡Œåº¦å®Œæ•´æµ‹è¯•
python -m pytest tests/ --tb=short --maxfail=10 -n auto
```

## ğŸ“ˆ æµ‹è¯•è¦†ç›–ç‡

### å½“å‰è¦†ç›–ç‡çŠ¶å†µ

- **æ•°æ®åº“è¿æ¥å±‚**: ~68% è¦†ç›–ç‡
- **æ¨¡å‹å±‚**: ~28% è¦†ç›–ç‡  
- **æ•´ä½“é¡¹ç›®**: ~6% è¦†ç›–ç‡ï¼ˆç”±äºè®¸å¤šæ¨¡å—å°šæœªè¢«æµ‹è¯•è¦†ç›–ï¼‰

### è¦†ç›–ç‡æ”¹è¿›å»ºè®®

1. **ä¼˜å…ˆçº§**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ > å·¥å…·ç±» > é…ç½®æ–‡ä»¶
2. **ç›®æ ‡**: æ ¸å¿ƒæ¨¡å—è¾¾åˆ°80%+ï¼Œæ•´ä½“é¡¹ç›®è¾¾åˆ°60%+
3. **ç­–ç•¥**: å¢é‡æ”¹è¿›ï¼Œæ¯ä¸ªPRéƒ½è¦æ±‚ä¸é™ä½è¦†ç›–ç‡

## ğŸ¯ æµ‹è¯•ç­–ç•¥

### æµ‹è¯•é‡‘å­—å¡”

```
       /\
      /  \  E2E Tests (å°‘é‡ï¼Œå…³é”®è·¯å¾„)
     /____\
    /      \
   / INTEG. \ Integration Tests (é€‚é‡ï¼Œä¸»è¦äº¤äº’)
  /__________\
 /            \
/  UNIT TESTS  \ Unit Tests (å¤§é‡ï¼Œå¿«é€Ÿåé¦ˆ)
/________________\
```

### å„å±‚æµ‹è¯•é‡ç‚¹

#### Unit Tests (å•å…ƒæµ‹è¯•)
- **ç›®æ ‡**: å•ä¸ªç±»ã€æ–¹æ³•çš„åŠŸèƒ½æ­£ç¡®æ€§
- **ç‰¹ç‚¹**: å¿«é€Ÿæ‰§è¡Œï¼Œç‹¬ç«‹è¿è¡Œï¼Œä½¿ç”¨Mock
- **ä½ç½®**: `tests/unit/`

#### Integration Tests (é›†æˆæµ‹è¯•)  
- **ç›®æ ‡**: æ¨¡å—é—´äº¤äº’ï¼Œæ•°æ®æµéªŒè¯
- **ç‰¹ç‚¹**: æ¶‰åŠçœŸå®æ•°æ®åº“ï¼Œæ–‡ä»¶ç³»ç»Ÿ
- **ä½ç½®**: `tests/integration/`

#### E2E Tests (ç«¯åˆ°ç«¯æµ‹è¯•)
- **ç›®æ ‡**: å®Œæ•´ä¸šåŠ¡æµç¨‹éªŒè¯
- **ç‰¹ç‚¹**: æœ€æ¥è¿‘ç”¨æˆ·ä½¿ç”¨åœºæ™¯
- **ä½ç½®**: `tests/e2e/`

## ğŸ“ ç¼–å†™æµ‹è¯•çš„æœ€ä½³å®è·µ

### å‘½åè§„èŒƒ
```python
# æµ‹è¯•ç±»å‘½å
class TestDocumentRepository:
    
# æµ‹è¯•æ–¹æ³•å‘½å - æè¿°æ€§ä¸”å…·ä½“
def test_find_by_id_returns_document_when_exists(self):
def test_find_by_id_returns_none_when_not_found(self):
def test_create_document_raises_error_with_invalid_data(self):
```

### æµ‹è¯•ç»“æ„ - AAAæ¨¡å¼
```python
def test_document_creation_success(self):
    # Arrange - å‡†å¤‡æµ‹è¯•æ•°æ®
    doc_data = {"title": "Test Doc", "content": "Test content"}
    
    # Act - æ‰§è¡Œè¢«æµ‹è¯•çš„æ“ä½œ
    result = document_service.create_document(doc_data)
    
    # Assert - éªŒè¯ç»“æœ
    assert result.id is not None
    assert result.title == "Test Doc"
```

### ä½¿ç”¨Fixtures
```python
# conftest.py
@pytest.fixture
def sample_document():
    return DocumentModel(
        title="Sample Document",
        content="Sample content"
    )

# æµ‹è¯•ä¸­ä½¿ç”¨
def test_document_processing(sample_document):
    result = process_document(sample_document)
    assert result.success
```

## ğŸ”® æœªæ¥æ”¹è¿›è®¡åˆ’

### çŸ­æœŸç›®æ ‡ (1-2å‘¨)
1. å¢åŠ æ ¸å¿ƒæœåŠ¡ç±»çš„å•å…ƒæµ‹è¯•è¦†ç›–ç‡åˆ°80%+
2. ä¿®å¤è¢«ignoreçš„æµ‹è¯•æ–‡ä»¶ä¾èµ–é—®é¢˜
3. æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•

### ä¸­æœŸç›®æ ‡ (1ä¸ªæœˆ)  
1. é›†æˆæµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°60%+
2. æ·»åŠ APIç«¯ç‚¹çš„å®Œæ•´æµ‹è¯•è¦†ç›–
3. å®ç°æµ‹è¯•æ•°æ®çš„è‡ªåŠ¨ç”Ÿæˆå’Œæ¸…ç†

### é•¿æœŸç›®æ ‡ (3ä¸ªæœˆ)
1. æ•´ä½“æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°75%+
2. å®ç°å®Œæ•´çš„CI/CDæµ‹è¯•æµæ°´çº¿
3. æ·»åŠ æ€§èƒ½å›å½’æµ‹è¯•å’Œç›‘æ§

---

## ğŸ’¡ å°è´´å£«

1. **æ—¥å¸¸å¼€å‘ä½¿ç”¨**: `python scripts/test_runner.py --quick`
2. **æäº¤å‰éªŒè¯**: `python scripts/test_runner.py --full` 
3. **é—®é¢˜è¯Šæ–­**: `python scripts/test_diagnostics.py`
4. **æ€§èƒ½è°ƒè¯•**: ä½¿ç”¨`--sequential --debug`å‚æ•°
5. **è¦†ç›–ç‡åˆ†æ**: ä»…åœ¨éœ€è¦è¯¦ç»†æŠ¥å‘Šæ—¶ä½¿ç”¨`--coverage`

æµ‹è¯•ç³»ç»Ÿç°åœ¨å·²ç»ä¼˜åŒ–å®Œæˆï¼Œå¯ä»¥ä¸ºå¼€å‘æä¾›å¿«é€Ÿã€å¯é çš„åé¦ˆï¼ğŸ‰