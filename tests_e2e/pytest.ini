[pytest]
# E2E Test Configuration

# Test discovery
testpaths = tests_e2e
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Markers
markers =
    e2e: End-to-end tests
    workflow: Complete workflow tests
    library: Library management tests
    rag: RAG query tests
    security: Security tests
    performance: Performance tests
    load: Load testing
    stress: Stress testing
    parallel: Tests that can run in parallel
    citations: Citation-related tests
    error_handling: Error handling tests
    cross_browser: Cross-browser compatibility tests
    slow: Slow running tests
    critical: Critical path tests
    smoke: Smoke tests
    regression: Regression tests

# Output and reporting
addopts = 
    -v
    --strict-markers
    --tb=short
    --capture=no
    --color=yes
    --html=tests_e2e/reports/report.html
    --self-contained-html
    --cov=src
    --cov-report=html:tests_e2e/coverage
    --cov-report=term-missing
    --maxfail=5
    --junitxml=tests_e2e/reports/junit.xml

# Timeout
timeout = 300
timeout_method = thread

# Parallel execution
# Use -n auto for automatic worker detection
# Use -n 4 for 4 parallel workers

# Log configuration
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = tests_e2e/logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(filename)s:%(lineno)d - %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Playwright configuration
playwright_headed = false
playwright_slow_mo = 100
playwright_screenshot = only-on-failure
playwright_video = retain-on-failure

# Custom options
custom_options =
    --headless: Run browsers in headless mode
    --slow-mo: Slow down browser operations (ms)
    --video: Record video of test execution
    --tracing: Enable Playwright tracing
    --har: Record HAR files
    --update-snapshots: Update visual regression baselines